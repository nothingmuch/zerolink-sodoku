<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>ZeroLink Sudoku</title>
<meta name="author" content="(Aviv Milner & Yuval Kogman)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="reveal.js-3.8.0/css/reveal.css"/>

<link rel="stylesheet" href="reveal.js-3.8.0/css/theme/moon.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'reveal.js-3.8.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@4.0.0-beta.2"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@5"></script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</head>
<body>
<div class="reveal none">
<div class="slides">
<section id="sec-title-slide" data-background="./images/inputs_linear_zoom.png"><h1 class="title" style="color: black; opacity: 0.8">ZeroLink Sudoku</h1><h2 class="author" style="color: black; opacity: 0.8">Aviv Milner &amp; Yuval Kogman</h2><div><img style="margin: 0 2.5em; vertical-align: middle; display: inline; border: none" src="./images/aviv.svg"><img style="margin: 0 2.5em; vertical-align: middle; border: none; display: inline" src="./images/yuval.svg" /></h2>
</section>

<section>
<section id="slide-orgd08c3b8">
<h2 id="orgd08c3b8">Hello</h2>
<ul>
<li>I'm <code>nothingmuch</code>, Yuval, יובל</li>
<li>hate software, tired of bureaucratic cargo cults and weaponized psychology</li>
<li>love-hate free software</li>
<li>still pursuing a dysfunctional relationship with software since Bitcoin
messed with my head</li>

</ul>
<aside class="notes">
<p>
interested in software that mediates voluntary associations and promotes
freedom
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orga6f1ccc">
<h2 id="orga6f1ccc">Caveats and Disclosures</h2>
<ul>
<li>Funding provided by zkSNACKs, the company behind Wasabi Wallet</li>
<li>No qualifications, just a confused code monkey, all errors my own</li>
<li>Biased (strongly in favor of privacy technology)</li>
<li>Zero-Link Sudoku: Real vs. Perceived Anonymity</li>

</ul>
</section>
<section id="slide-orga6f1ccc-split">

<h2>Caveats and Disclosures</h2>
<ul>
<li>Funding provided by zkSNACKs, the company behind Wasabi Wallet</li>
<li>No qualifications, just a confused code monkey, all errors my own</li>
<li>Biased (strongly in favor of privacy technology)</li>
<li>[WIP] Zero-Link <del>Sudoku</del>: <del>Real vs.</del> Perceived Anonymity*</li>

</ul>
<aside class="notes">
<p>
This project was started by Aviv Milner, who wrote and submitted the abstract.
He invited me to help out in case it was accepted, and once it was also
arranged that I receive some support from zkSNACKs, the company behind Wasabi
Wallet.
</p>

<p>
Unfortunately Aviv could not attend or be actively involved for the last few
weeks. What follows is my best attempt at picking up where he left off. These
are preliminary results, prepared at the last minute as a tradeoff between
setbacks, and have received no serious review or criticism.
</p>

<p>
I am not comfortable saying anything conclusive about "real world" anonymity,
and the "sudoku" bit is still not working.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org0fb87ff">
<h2 id="org0fb87ff">Outline</h2>
<ol>
<li>What is Wasabi Wallet and what is it for</li>
<li>Stare a bit at Wasabi transaction graph</li>
<li>Future directions</li>

</ol>


<div class="figure">
<p><object type="image/svg+xml" data="./images/repo.svg" class="org-svg" style="vertical-align: middle; margin-top: -1em; position: absolute; right: -3em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
<a href="https://github.com/nothingmuch/zerolink-sudoku">https://github.com/nothingmuch/zerolink-sudoku</a>
</p>
</section>
</section>
<section>
<section id="slide-org883a053">
<h2 id="org883a053">Introduction</h2>
<div class="outline-text-2" id="text-org883a053">
</div>
</section>
</section>
<section>
<section id="slide-org1a40782">
<h3 id="org1a40782">What is Wasabi Wallet</h3>
<p>
Wasabi is an open source Bitcoin wallet for desktop focused on privacy,
including Chaumian CoinJoin functionality, a non-custodial mixing technique.
</p>

<p>
The first beta release was on August 1st 2018 followed by stable release on
October 31st.
</p>

<aside class="notes">
<p>
If that means anything to you, great, if not, I'm hoping to explain it
hopefully without getting lost in details. Feel free to interrupt for
questions, and please remind me to repeat the questions for the mic.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org7d202ce">
<h3 id="org7d202ce">Terminology</h3>
<aside class="notes">
<p>
First I want to clarify how I'm going to use some overloaded terminology.
</p>

</aside>
</section>
<section id="slide-org6ecba93">
<h4 id="org6ecba93">Privacy</h4>
<p>
By "privacy" I mean an individual's ability to send and receive payments
without revealing information about their financial activity or their wealth
ty to their counterparties or the rest of the world.
</p>

</section>
<section id="slide-org6ecba93-split">
<p>
This is a narrow sense of the word, even in the context of Bitcoin. For a
broader and deeper treatment:
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/belcher_tweet.svg" class="org-svg" style="vertical-align: middle; position: absolute; right: -1em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>
<center>
<blockquote class="twitter-tweet" data-theme="dark" data-dnt="true" data-lang="en"><p lang="en" dir="ltr">For the last few weeks I&#39;ve been working on a literature review for bitcoin privacy:  <a href="https://t.co/hmDf0JT8Ky">https://t.co/hmDf0JT8Ky</a>  It aims to cover about all privacy issues in bitcoin, including Lightning network, and has a bunch of examples to help demonstrate how the concepts work in practice.</p>&mdash; belcher (@chris_belcher_) <a href="https://twitter.com/chris_belcher_/status/1099403015444987904?ref_src=twsrc%5Etfw">February 23, 2019</a></blockquote>
</center>

</section>
<section id="slide-org39c0f1a">
<h4 id="org39c0f1a">Whitepaper says</h4>

<div class="figure">
<p><img src="./images/whitepaper_privacy.png" alt="whitepaper_privacy.png" />
</p>
</div>
<aside class="notes">
<p>
Mostly for historical context, this is what the whitepaper had to say, which
unfortunately understates the privacy concerns in my opinion.
</p>

</aside>
</section>
<section id="slide-org5aca409">
<h4 id="org5aca409">Fungibility</h4>
<p>
By "fungible" I mean that units of a currency are interchangeable with or
indistinguishable from one another.
</p>

<p>
Fungibility is an important property of money since without it a specific
set of funds may not be worth its face value, introducing risk and friction
when receiving payments.
</p>

</section>
<section id="slide-org5aca409-split">
<p>
Censorship resistance at the protocol level only applies to miners
confirming transactions, not to them being accepted as payment.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/steganographic_principle.svg" class="org-svg" style="vertical-align: middle; margin-top: -1em; position: absolute; right: -4em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
<a href="https://joinmarket.me/blog/blog/the-steganographic-principle/">https://joinmarket.me/blog/blog/the-steganographic-principle/</a>
</p>

<aside class="notes">
<p>
In principle any Bitcoin privacy technology should improve fungibility. With
sufficient adoption this may even hold true in the real world, but
depending on its nature degredation of fungibility is also possible.
</p>

<p>
Here I'd like to refer you to a thoughtful post by Adam Gibson, another
JoinMarket developer, which explores the tradeoffs between scalability,
privacy, and security.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org31faa5f">
<h3 id="org31faa5f">Simplified Transaction Graph Model</h3>
</section>
<section id="slide-org31faa5f-split">
<p>
Bitcoin transactions consume prior outputs to create new ones. Outputs can be
thought of as a pair:
</p>

<p>
\((\textit{Amount}, \textit{Spending Condition})\)
</p>

</section>
<section id="slide-org31faa5f-split">
<p>
Suppose Alice mines a block:
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/tx_graph_1_coinbase.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

</section>
<section id="slide-org31faa5f-split">
<p>
&#x2026;and then donates to WikiLeaks:
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/tx_graph_2_donation.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

</section>
<section id="slide-org31faa5f-split">
<p>
&#x2026;and then buys alpaca socks on the dark web:
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/tx_graph_3_purchase.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<aside class="notes">
<p>
For this presentation we can mostly think of the blockchain as containing a
bipartite graph with unlabeled directed edges connecting transactions and
outputs.
</p>

<p>
(technical pedantry:
</p>
<ul>
<li>the actual transaction graph is more like a transpose of what I've drawn
since later transactions point at prior inputs, not the other way around</li>
<li>or actually it's more like a multigraph between transactions where
inputs are labeled edges and outputs are contained in the transaction)</li>

</ul>

</aside>
</section>
</section>
<section>
<section id="slide-org0699ba5">
<h3 id="org0699ba5">Privacy &amp; Fungibility Challenges</h3>
<p>
Recall that to be valid a Bitcoin transaction must:
</p>

<ul>
<li>Only consume previously unspent coins as inputs</li>
<li>Create coins as outputs with value constrained by inputs</li>
<li>Prove spending authority according to the conditions specified at output creation</li>

</ul>

</section>
<section id="slide-org0699ba5-split">
<p>
This means the following is public information available to any validating node:
</p>

<ul>
<li>All unspent coins at any point in time</li>
<li>All transactions and how they are connected</li>
<li>Related cryptographic public keys and signatures (generally after spending)</li>

</ul>

</section>
<section id="slide-org0699ba5-split">
<p>
In other words Bitcoin is:
</p>

<ul>
<li>Trivially non fungible: every coin is uniquely identifiable within the transaction graph</li>
<li>Not very private: transactions leak information, especially to counterparties.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgcff4c41">
<h3 id="orgcff4c41">Early Research</h3>
<p>
The consequences of this design (and other aspects of privacy) have been
studied in a number of works:
</p>

</section>
<section id="slide-orgcff4c41-split">
<ul>
<li><a href="https://sci-hub.tw/https://link.springer.com/chapter/10.1007/978-1-4614-4139-7_10">An Analysis of Anonymity in the Bitcoin System</a> Reid, F., &amp; Harrigan, M. (2011)</li>
<li><a href="https://eprint.iacr.org/2012/584">Quantitative Analysis of the Full Bitcoin Transaction Graph</a> Ron, D., &amp; Shamir, A. (2012)</li>
<li><a href="http://sci-hub.tw/https://link.springer.com/chapter/10.1007/978-3-642-39884-1_4">Evaluating User Privacy in Bitcoin</a> Androulaki, E., Karame, G. O., Roeschlin, M., Scherer, T., &amp; Capkun, S. (2013)</li>
<li><a href="https://cseweb.ucsd.edu/~smeiklejohn/files/imc13.pdf">A Fistful of Bitcoins</a> Meiklejohn, S., Pomarole, M., Jordan, G., Levchenko, K., McCoy, D., Voelker, G. M., Savage, S. (2013)</li>

</ul>

<p>
<object type="image/svg+xml" data="./images/reid.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<object type="image/svg+xml" data="./images/ron.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<object type="image/svg+xml" data="./images/androulaki.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<object type="image/svg+xml" data="./images/meiklejohn.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</section>
<section id="slide-orgcff4c41-split">
<p>
These papers all share mostly overlapping definitions of two commonly used
heuristics for clustering the graph, both of which trace back to the whitepaper
</p>

</section>
<section id="slide-orgff2b390">
<h4 id="orgff2b390">Common Ownership Heuristic</h4>

<div class="figure">
<p><img src="./images/whitepaper_common_ownership_heuristic.png" alt="whitepaper_common_ownership_heuristic.png" />
</p>
</div>
</section>
<section id="slide-orgfb09b5b">
<h4 id="orgfb09b5b">Change Identification Heuristic</h4>

<div class="figure">
<p><img src="./images/whitepaper_change_identification_heuristic.png" alt="whitepaper_change_identification_heuristic.png" />
</p>
</div>

<aside class="notes">
<p>
Based on ordering, amounts, address types, whether or not an address has
been used before, or other transaction data.
For a more comprehensive review of various heuristics, again I'd like to
refer you to the Privacy entry on the Bitcoin wiki.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org631240a">
<h3 id="org631240a">What is CoinJoin?</h3>
<p>
A mixing technique to defeat one or both heuristics.
</p>

<ul>
<li>Users can collaborate to create joint transactions without giving up control over coins.</li>

<li>Equal amount outputs of a single transaction are in a sense fungible (assuming no
address reuse, and ignoring considerations of any subsequent transactions)</li>

</ul>

<aside class="notes">
<p>
Common ownership heuristic is defeated by definition.
</p>

<p>
Change identification can be defeated to some extent when making a payment through coinjoin,
</p>

<p>
Transaction size limits limit degree of mixing in a single transaction, but
with remixing the ambiguity can extend to an entire subgraph of transactions.
</p>

</aside>

</section>
<section id="slide-org631240a-split">

<div class="figure">
<p><img src="./images/tx.flow.png" alt="tx.flow.png" />
</p>
</div>


<div class="figure">
<p><object type="image/svg+xml" data="./images/coinjoin_thread.svg" class="org-svg" style="vertical-align: middle; position: absolute; margin: -1em; right: 0;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
<a href="https://bitcointalk.org/index.php?topic=279249.0">bitcointalk.org thread</a>
</p>

</section>
<section id="slide-org631240a-split">
<div style="vertical-align: middle; position: absolute; right: -1em;" class="div">

<div class="figure">
<p><object type="image/svg+xml" data="./images/nopara_tweet.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>


<div class="figure">
<p><object type="image/svg+xml" data="./images/nopara_post.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>


<div class="figure">
<p><object type="image/svg+xml" data="./images/nopara_pastebin.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

</div>

<center>
<blockquote class="twitter-tweet" data-conversation="none" data-cards="hidden" data-theme="dark" data-dnt="true" data-lang="en"><p lang="en" dir="ltr">As far as I succeeded to track it back &quot;hashcoin&quot; was the first person I found who suggested coinjoin in July 02, 2011, Bitcointalk: <a href="https://t.co/p3E8KW8ZgO">https://t.co/p3E8KW8ZgO</a><a href="https://t.co/YPzIYUsLtb">https://t.co/YPzIYUsLtb</a></p>&mdash; nopara73 (@nopara73) <a href="https://twitter.com/nopara73/status/1159450665715978240?ref_src=twsrc%5Etfw">August 8, 2019</a></blockquote>
<blockquote class="twitter-tweet" data-theme="dark" data-dnt="true" data-lang="en"><p lang="en" dir="ltr">&quot;After it has been passed around once, it gets passed around again.  This time, assuming my input and output is still there, I sign the tx and pass it on.  If everyone signs it, it is broadcast and we&#39;re done.&quot;</p>&mdash; nopara73 (@nopara73) <a href="https://twitter.com/nopara73/status/1159451190373093377?ref_src=twsrc%5Etfw">August 8, 2019</a></blockquote>
</center>
</section>
</section>
<section>
<section id="slide-orgc115a35">
<h3 id="orgc115a35">Some CoinJoin implementations</h3>
<ul>
<li>JoinMarket - peer to peer market based model</li>
<li>Wasabi - Chaumian CoinJoin</li>
<li>Samourai - Chaumian CoinJoin</li>

</ul>


<div class="figure">
<p><object type="image/svg+xml" data="./images/coinjoin_research_repo.svg" class="org-svg" style="vertical-align: middle; position: absolute; margin: -1em; right: -3em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
More: <a href="https://github.com/6102bitcoin/CoinJoin-Research">https://github.com/6102bitcoin/CoinJoin-Research</a>
</p>

<aside class="notes">
<p>
In JoinMarket, makers offer coins for mixing, and takers construct coinjoins
paying makers a fee.
</p>

<p>
In both Samourai and Wasabi a central server is used to to coordinate
transaction creation.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgf6b1b14">
<h3 id="orgf6b1b14">Does CoinJoin provide privacy?</h3>
<p>
Yes, with caveats.
</p>

<aside class="notes">
<p>
CoinJoin can be used today to gain privacy, but requires dilligence to avoid
privacy leaks when considering the transaction graph as a whole, i.e.
post-mix linking, interactions with other wallets, and things like temporal
patterns or privacy at the network layer.
</p>

<p>
Assuming you're not mixing with Sybils, if you CoinJoin after receiving and
before/during spending you can gain a reasonable level of privacy as narrowly
defined earlier in this talk.
</p>

<p>
JoinMarket offers the most flexibility (user controlled denominations and
ability to make arbitrary payments in coinjoin transactions).
</p>

</aside>

</section>
<section id="slide-orgf6b1b14-split">
</section>
</section>
<section>
<section id="slide-org7849884">
<h3 id="org7849884">CoinJoin Research</h3>
<ul>
<li><a href="http://www.coinjoinsudoku.com/">CoinJoin Sudoku</a> Atlas, K. (2014)</li>
<li><a href="https://sci-hub.tw/https://ieeexplore.ieee.org/abstract/document/7966968/">Anonymous Alone? Measuring Bitcoin’s Second-Generation Anonymization Techniques</a> Moser, M., &amp; Bohme, R. (2017)</li>
<li><a href="https://www.comsys.rwth-aachen.de/fileadmin/papers/2017/2017-maurer-trustcom-coinjoin.pdf">Anonymous CoinJoin Transactions with Arbitrary Values</a> Maurer, F. K., Neudecker, T., &amp; Florian, M. (2017)</li>

</ul>

<p>
<object type="image/svg+xml" data="./images/atlas.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<object type="image/svg+xml" data="./images/moser.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<object type="image/svg+xml" data="./images/maurer.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</section>
</section>
<section>
<section id="slide-org8435e15">
<h3 id="org8435e15">Does CoinJoin provide fungibility?</h3>
<p>
That remains to be seen.
</p>

<aside class="notes">
<p>
If widely use then it may very well create a status quo where many or most
coins have an ambiguous history.
</p>

<p>
If reliability of the transaction graph as a whole as a basis for censorship
is challenged, then fungibility may be a status quo (c.f. mp-ecdsa, payjoin,
taproot).
</p>

<p>
e.g. MtGoxAndOthers cluster on wallet explorer
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orga45f828">
<h3 id="orga45f828">Chaumian CoinJoin in Wasabi</h3>
<p>
ZeroLink is a protocol which allows users to anonymously participate in
CoinJoin transactions mediated by a centralized server.
</p>

<p>
It utilizes blind signatures in order to hide the link between users' inputs
and outputs in the transaction.
</p>

<p>
Samourai and Wasabi share a common heritage but have diverged in their
implementations.
</p>
</section>
<section id="slide-org9ba79b8">
<h4 id="org9ba79b8">Blind Signatures</h4>
<p>
Invented by David Chaum, these signatures allow a signer to sign a message
without knowing its contents.
</p>

<p>
Wasabi currently uses Schnorr blind signatures over secp256k1 but originally
used RSA.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/blind_sig_impl.svg" class="org-svg" style="vertical-align: middle; margin-top: -2em; position: absolute; right: -3em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
<a href="https://github.com/MetacoSA/NBitcoin/blob/a615d201aff38b55e954fa3a184a0a439f202b12/NBitcoin/Crypto/SchnorrBlindSignature.cs">NBitcoin/Crypto/SchnorrBlindSignature.cs</a>
</p>

</section>
<section id="slide-org9ba79b8-split">
<p>
Signer with public key \(P = dG\), generates a nonce \(r\) and sends \(R = rG\)
to requester.
</p>

<p>
Requester generates random blinding factors \(v\) and \(w\), creates and sends a
blinded commitment to the message
\(c' = c - w\)
where
\(c = H(m || R + vG + wP)\).
</p>

</section>
<section id="slide-org9ba79b8-split">
<p>
Signer responds with blinded signature \(s' = r - c'd\).
</p>

<p>
Requester computes \(s = s' + v\) to obtain the complete unblinded signature
for \(m\), \((c, s)\).
</p>

</section>
<section id="slide-org9ba79b8-split">
<p>
Verifier computes \(H(m || cP + sG) =? c\)
</p>

<div>
\begin{align}
   &H(m || cP + sG) \\
 = &H(m || cdG + (s'+v)G ) \\
 = &H(m || cdG + ((r-(c-w)d) + v)G ) \\
 = &H(m || cdG + rG - cdG + wdG + vG ) \\
 = &H(m || rG + wdG + vG ) \\
 = &H(m || rG + vG + wdG) \\
 = &H(m || R + vG + wP) \\
\end{align}

</div>

<aside class="notes">
<p>
Since I can never remember the details of this stuff, here's a worked
version of the verificatoin equation in case anyone asks.
</p>

</aside>
</section>
<section id="slide-orgcdcda57">
<h4 id="orgcdcda57">Simplified Protocol</h4>
<p>
Alice is a user, one of several participants.
</p>

<p>
Bob is also Alice, using a different tor identity.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/coordinator_api.svg" class="org-svg" style="vertical-align: middle; margin-top: -1em; position: absolute; right: -3em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
<a href="https://wasabiwallet.io/swagger/index.html">https://wasabiwallet.io/swagger/index.html</a>
</p>

</section>
<section id="slide-orgcdcda57-split">

<div class="figure">
<p><object type="image/svg+xml" data="./images/chaumian_coinjoin_sequence_diagram.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<aside class="notes">
<p>
First Alice proves to the coordinator that she is able to spend some coins
she would like to add to a mixing round of some a known denomination,
providing a change output script and several blinded output script.
</p>

<p>
The coordinator verifies and responds with a signature on the blinded
output.
</p>

<p>
Later, Alice reconnects on a new tor circuit, and produces the unblinded
output and signature, which the coordinator verifies ensuring that "Bob"
did indeed participate in input registration, but without being able to
link the signature to Alice's input or change.
</p>

<p>
The coordinator constructs the CoinJoin transaction by gathering the
unblinded output scripts, which Alice can then sign upon verification that
her are included and add up to the right amount, and when all Alices have
signed, the CoinJoin transaction can be broadcast.
</p>

</aside>
</section>
<section id="slide-orga4efd4b">
<h4 id="orga4efd4b">Questions so far?</h4>
</section>
</section>
<section>
<section id="slide-orgaae6f07">
<h2 id="orgaae6f07">Wasabi Usage Analysis</h2>
<aside class="notes">
<p>
Aviv began by carefully looking at few arbitrarily selected transactions
and defining some metrics and properties of interest.
</p>

<p>
I attempted to implement his approach in software using BlockSci, but after
running into trouble with the underlying rocksdb, due to fast approaching
deadline and the much narrower requirements ended up rolling my own .
</p>

<p>
Current approach still uses Python, but provides a lazy loaded (async) high
level representation of only the transaction graph.
</p>

<p>
Data is read from an SQLite database, falling back to Esplora and Electrum
when missing.
</p>

<p>
Used guix for dependencies, including WIP blocksci package for guix in case
anyone is interested (rocksdb issues)
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgfa6521c">
<h3 id="orgfa6521c">Obtaining Wasabi Subgraph</h3>
<ol>
<li>Get transactions which pay coordinator
<ul>
<li>of these, the threshold for a CoinJoin is 5 or more equal amount outputs</li>

</ul></li>
<li>Downloaded all transactions associated with all scripts
spent or created in these transactions.</li>

</ol>
<aside class="notes">
<ul>
<li>Thanks to blockstream &amp; electrum servers for not banning me</li>

</ul>

</aside>

</section>
<section id="slide-orgfa6521c-split">
<ul>
<li>5118 CoinJoin transactions creating 583561 and 557306 distinct scripts (as of block 592352)</li>
<li>inputs total 117746 BTC, 46290 of which are from non CoinJoin transactions</li>
<li>average output lifetime is 726 blocks, 942 for base denomination outputs and 531 for others</li>

</ul>
</section>
</section>
<section>
<section id="slide-org542f306">
<h3 id="org542f306">Transactions</h3>
<div id="txns_participants"></div>

<script>
const spec = "plots/txns_participants.vl.json";
vegaEmbed("#txns_participants", spec)
// result.view provides access to the Vega View API
.then(result => console.log(result))
.catch(console.warn);
</script>
</section>
<section id="slide-org039e2e8">
<h4 id="org039e2e8">Outputs - Overview</h4>

<div class="figure">
<p><img src="./plots/output_denominations_log_cropped_overview.png" alt="output_denominations_log_cropped_overview.png" />
</p>
</div>
<aside class="notes">
<p>
In this plot we see coinjoin output amounts plotted over time.
</p>

<p>
The size and color of a point corresponds to the number of outputs of that
amount in a transaction (change output is typically black, purple and reddish
colors are in the low 10s, and yellow to white is approaching 100 (change
output is typically black, purple and reddish colors are in the low 10s, and
yellow to white is approaching 100).
</p>

</aside>
</section>
<section id="slide-orgdd5c9a4">
<h4 id="orgdd5c9a4">Inputs - Overview</h4>

<div class="figure">
<p><img src="./plots/inputs_log_cropped_overview.png" alt="inputs_log_cropped_overview.png" />
</p>
</div>
<aside class="notes">
<p>
Before we look in a bit more detail, here is the corresponding plot of
outputs spent by coinjoins. Here points are individual inputs, but remixed
coins are still colored the same as the mixed outputs from the previous plot.
</p>

<p>
I find it's helpful to think of having mixed outputs of the base denomination
as a sort of ground state that the Wasabi client tries to reach whenever
coins are queued for mixing.
</p>

</aside>
</section>
<section id="slide-org444a185">
<h4 id="org444a185">Inputs not originating from Wasabi CoinJoins</h4>

<div class="figure">
<p><img src="./plots/non_coinjoin_inputs_log.png" alt="non_coinjoin_inputs_log.png" />
</p>
</div>
</section>
<section id="slide-org74f5c2a">
<h4 id="org74f5c2a">Inputs - 1.0.x</h4>

<div class="figure">
<p><img src="./plots/inputs_log_1.0.png" alt="inputs_log_1.0.png" />
</p>
</div>
<aside class="notes">
<p>
Let's zoom in to look at Wasabi's 1.0.x era, before the protocol upgrade that
introduce multiple mixed outputs for users with larger amounts.
</p>

<p>
Here we can see Wasabi's original coin selection and mixing at work, as
large amounts enter the pool.
</p>

<p>
Also note consolidations of small change outputs in lower left corner
</p>

</aside>
</section>
<section id="slide-org7c7202c">
<h4 id="org7c7202c">Outputs - 1.0.x</h4>

<div class="figure">
<p><img src="./plots/output_denominations_log_1.0.png" alt="output_denominations_log_1.0.png" />
</p>
</div>
</section>
<section id="slide-orga57c66f">
<h4 id="orga57c66f">Outputs - 1.0.x</h4>

<div class="figure">
<p><img src="./plots/output_denominations_lin_1.0.png" alt="output_denominations_lin_1.0.png" />
</p>
</div>
<aside class="notes">
<p>
Plotting this in linear scale (with some higher values cropped out) makes the
pattern of users with large amounts even more striking.
</p>

</aside>
</section>
<section id="slide-orgbff4f21">
<h4 id="orgbff4f21">Outputs - 1.1.x</h4>

<div class="figure">
<p><img src="./plots/output_denominations_log_1.1.png" alt="output_denominations_log_1.1.png" />
</p>
</div>
<aside class="notes">
<p>
Wasabi 1.1.0 changed the Chaumian CoinJoin protocol, introducing outputs
which are multiples of the base denomination, and also causing users to
deploy more sophisticated coin selection.
</p>

</aside>
</section>
<section id="slide-org7ad3da2">
<h4 id="org7ad3da2">Evolution of Wasabi Coin Selection</h4>
<ul>
<li>1.0.0 greedy algorithm, ordered by amount</li>
<li>1.0.2 minimize # of inputs, if &gt;1 minimize amount</li>
<li>1.1.0 forced upgrade (protocol change)</li>
<li>1.1.4 prefer lower anonymity set size inputs</li>
<li>1.1.6 if coin selection would generate change, add in small change with
same or better anon set size</li>

</ul>
<aside class="notes">
<p>
Note that coin selection logic only applies to queued coins, for spending
and queuing coins must be selected manually.
</p>

<p>
Uses LINQ and assuming stable sorting, such that prior sorts break ties of
later ones.
</p>

<p>
The change introduced in 1.1.6 caused me to obsess endlessly about change
attribution.
</p>

</aside>
</section>
<section id="slide-org259f940">
<h4 id="org259f940">Outputs - 1.1.x detail</h4>

<div class="figure">
<p><img src="./plots/output_denominations_lin_1.1_detail.png" alt="output_denominations_lin_1.1_detail.png" />
</p>
</div>
<aside class="notes">
<p>
If we zoom in around 1 bitcoin sized outputs, again in linear scale, we can
see some more patterns which are again a consequence of coin selection and
the decaying round denominations.
</p>

</aside>
</section>
<section id="slide-org19124ce">
<h4 id="org19124ce">Inputs - 1.1.x detail</h4>

<div class="figure">
<p><img src="./plots/inputs_lin_1.1_detail.png" alt="inputs_lin_1.1_detail.png" />
</p>
</div>
<aside class="notes">
<p>
The reason for this is that amounts like 0.5 or 1.0 bitcoin are continually
brought in, which creates these upwards sloping black lines of change
outputs that mirror the round denomination decreases above them.
</p>

<p>
Also note how remixed inputs surround the tighter traces left by the
outputs (though this plot doesn't really show the volume of coins that are
remixed more quickly).
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgaf18202">
<h3 id="orgaf18202">Attribution of Change Outputs</h3>
<p>
Coordinator logic is pretty complicated:
</p>
<ul>
<li>denomination adjusts upwards to accomodate user w/ smallest input sum @ 0% mixing fees</li>
<li>users only pay the fees that they can</li>
<li>"keep the change" below threshold</li>
<li>users with change pay exact coordinator fees</li>
<li>global mining fee adjustment right before signing</li>

</ul>
</section>
<section id="slide-orgaf18202-split">

<h3>Attribution of Change Outputs</h3>
<ul>
<li>Iterated by alternating mixed integer programming with buggy and unsupported closed source software running on meat coprocessor</li>
<li>Limited success so far</li>
<li>Ashamed to admit I used google spreadsheet, but hey at least it's not a blockchain</li>

</ul>
<section data-background-iframe="https://docs.google.com/spreadsheets/d/e/2PACX-1vTkXHkeaGLnbXvgZ4TNgKASgGO3If_NW3SY-oPQFKu42jFiPTH7W_4z2N-U9ydlVInTS83OIgJfk3Tb/pubhtml?widget=true&amp;headers=false" data-background-interactive>
</section>
</section>
<section id="slide-orgaf18202-split">
</section>
</section>
<section>
<section id="slide-org96ab652">
<h3 id="org96ab652">Post Mix Hygiene</h3>
<p>
Aviv identified 4 potential issues:
</p>

<ol>
<li>Merging of mixed and unmixed coins</li>
<li>Consolidation of mixed coins</li>
<li>Dust attacks</li>
<li>Temporal patterns</li>

</ol>
<aside class="notes">
<p>
Since my clustering efforts were focused on change attribution, I can only
present a superficial analysis of the first three issues.
</p>

</aside>
</section>
<section id="slide-orgbd3c890">
<h4 id="orgbd3c890">Non CoinJoin transactions spending both mixed and non mixed inputs</h4>

<div class="figure">
<p><img src="./plots/taint_log.png" alt="taint_log.png" />
</p>
</div>
</section>
<section id="slide-org9b9b5ac">
<h4 id="org9b9b5ac">Non coinjoin transactions spending multiple mixed coins</h4>

<div class="figure">
<p><img src="./plots/consolidation_log.png" alt="consolidation_log.png" />
</p>
</div>
</section>
<section id="slide-org11c1c33">
<h4 id="org11c1c33">Dust</h4>
<p>
Wasabi 1.1.3 ignores &lt; 0.0001 BTC outputs
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./images/nopara_dust.svg" class="org-svg" style="vertical-align: middle; position: absolute; right: -1em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<center>
<blockquote class="twitter-tweet" data-theme="dark" data-dnt="true" data-cards="hidden" data-lang="en"><p lang="en" dir="ltr">Wasabi users are under dust attack and it seems to be somewhat successful. About half of them don&#39;t mind joining together some of their dusts, exposing the links between their mixed outputs (not the mixes though.) I&#39;ll hide the dust in the next release.<a href="https://t.co/Cbdw5QEXBz">https://t.co/Cbdw5QEXBz</a></p>&mdash; nopara73 (@nopara73) <a href="https://twitter.com/nopara73/status/1105779583410946049?ref_src=twsrc%5Etfw">March 13, 2019</a></blockquote>
</center>

</section>
<section id="slide-org11c1c33-split">
<p>
Only found 58 spent outputs (and 143 total) s.t.:
</p>

<ul>
<li>&lt;= 10000 satoshi in value</li>
<li>not funded by a Wasabi CoinJoin</li>
<li>shares script with some Wasabi CoinJoin output</li>

</ul>

<p>
This seems like a false negative.
</p>
</section>
</section>
<section>
<section id="slide-org05c8c6a">
<h3 id="org05c8c6a">Address Reuse</h3>

<div class="figure">
<p><object type="image/svg+xml" data="./images/2034.svg" class="org-svg" style="vertical-align: middle; position: absolute; right: -4em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<ul>
<li><a href="https://github.com/zkSNACKs/WalletWasabi/issues/2034">Issue #2034 - Address Reuse occurs in Blinded Outputs</a></li>
<li>Some users known to have used same seed in several wallets concurrently</li>

</ul>

</section>
<section id="slide-org05c8c6a-split">

<aside class="notes">
<p>
Again because I have not tackled clustering, and also because this is a
somewhat contentious issue lately, I'm not ready to say anything definitive
about address reuse rates, except that it happens, and it seems to happen
quite often. 
</p>

<p>
Even before a more systematic approach to clustering, I would like to see if
address reuse can be correlated with change chains in order to try and
understand how variable reuse rates are among users.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgdde36af">
<h3 id="orgdde36af">Anonymity Set Size</h3>
<p>
Wasabi defines the anonymity set gained per transaction output in terms of
the number of its indistinguishable siblings.
</p>

<p>
Outputs inherit smallest size from funding inputs.
</p>

<aside class="notes">
<p>
Although Aviv mentioned it in the submitted abstract, apart from some
theoretical objections to the anonymity set size metric I have little to
say so far about how to amprove Wasabi's reported metrics.
</p>

<ul>
<li>base case is right</li>
<li>but recursive definition both double counts and under counts</li>
<li>the dimension arguably not very meaningful, potentially misleading</li>
<li>requires private information to calculate, no clear strategy for how to
account for remixing apart from ever widening intervals</li>

</ul>

</aside>

</section>
<section id="slide-orgdde36af-split">
<p>
This can both under and overestimate the actual privacy gained:
</p>

<div class="figure">
<p><object type="image/svg+xml" data="./images/goodhart.svg" class="org-svg" style="vertical-align: middle; position: absolute; right: -4em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<ul>
<li>A clique of users constantly remixing wastes block space and costs users
money with little benefit to them or the network.</li>
<li>Inputs coming from distinct CoinJoin contribute their anon set size to
all plausible outputs, which is supra-linear.</li>

</ul>

<aside class="notes">
<p>
Goodhart's Law
</p>

</aside>

</section>
<section id="slide-orgdde36af-split">

<div class="figure">
<p><object type="image/svg+xml" data="./images/boltzmann.svg" class="org-svg" style="vertical-align: middle; position: absolute; right: -4em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
LaurentMT's <a href="https://github.com/Samourai-Wallet/boltzmann">Boltzmann</a> defines useful metrics, but:
</p>

<ul>
<li>entropy measure is hard to interpret for Wasabi CoinJoins</li>
<li>underlying linking probability matrix used to derive is more appropriate, but
scales exponentially in tx size</li>

</ul>
</section>
<section id="slide-orgdde36af-split">
<p>
This is a difficult problem, especially if looking beyond isolated
transactions.
</p>

<p>
Please share your thoughts with me!
</p>
</section>
</section>
<section>
<section id="slide-orgebc02cf">
<h2 id="orgebc02cf">Future Directions</h2>
<p>
(and some bonus slides presented in log scale)
</p>
</section>
</section>
<section>
<section id="slide-org7de6fe5">
<h3 id="org7de6fe5">This Research</h3>
<ul>
<li>Bugs, problems, minimal coding standards</li>
<li>Finish analyses</li>
<li>Read-at-height semantics for reproducible results</li>
<li>Integrate different analyses</li>
<li>Presentable Jupyter notebook, tidy up plots</li>

</ul>
</section>
</section>
<section>
<section id="slide-orga4fb55a">
<h3 id="orga4fb55a">Additional Research</h3>
<div class="outline-text-3" id="text-orga4fb55a">
</div>
</section>
<section id="slide-orgbc6cae5">
<h4 id="orgbc6cae5">Additional Data Sources</h4>
<ul>
<li>Clustering
<ul>
<li>Public Lightning Channels</li>
<li>Exchanges</li>

</ul></li>
<li>JoinMarket &amp; Whirlpool</li>

</ul>
</section>
</section>
<section>
<section id="slide-orge388c70">
<h3 id="orge388c70">Possible Wasabi Improvements</h3>
<div class="outline-text-3" id="text-orge388c70">
</div>
</section>
<section id="slide-org33e13e8">
<h4 id="org33e13e8">Pre-spend diagnostics:</h4>
<ul>
<li>Spending unmixed coins</li>
<li>Linking of different classes of inputs</li>
<li>Recipient script type compared to Wasabi's</li>

</ul>
</section>
<section id="slide-org330c1af">
<h4 id="org330c1af">Address reuse prevention</h4>
<p>
Banning seen addresses from CoinJoin transactions does nothing for sybil
attacks, but can help users avoid accidental reuse.
</p>
</section>
<section id="slide-org6cfcfe9">
<h4 id="org6cfcfe9">Coin selection during queing</h4>
<p>
Wasabi outputs inherit labels from prior linked coins until the anonymity
set size target is reached, at which point it is cleared.
</p>

<p>
This data is semi structured, and could be parsed or made structured in
order to avoid entangling coins with unrelated histories when queining.
</p>
</section>
</section>
<section>
<section id="slide-org96c5fa2">
<h3 id="org96c5fa2">Chaumian CoinJoin improvements</h3>
<div class="outline-text-3" id="text-org96c5fa2">
</div>
</section>
<section id="slide-org34e45d4">
<h4 id="org34e45d4">Differential fees</h4>
<p>
Allow output of distinct prior coinjoins to participate free to create
incentive for broader transaction graph and slower (constant?) denomination
reductions.
</p>

<p>
Samourai's Whirlpool does something similar (among other differences), new
entrants pay to mix with older participants, tx0
</p>
</section>
<section id="slide-org6ba3b37">
<h4 id="org6ba3b37">Prepaid Fees</h4>
<ul>
<li>Opt-in registration of small inputs into CoinJoins</li>
<li>PrivacyPass style long lived tokens</li>
<li>Redeem during input registration to cover coordinator and mining fees</li>

</ul>
</section>
<section id="slide-orgd5cd85c">
<h4 id="orgd5cd85c">Unequal amounts</h4>
<p>
Another difficult problem.
</p>
</section>
</section>
<section>
<section id="slide-org6ac9663">
<h3 id="org6ac9663">Bitcoin Ecosystem</h3>
<div class="outline-text-3" id="text-org6ac9663">
</div>
</section>
<section id="slide-orgdff78ba">
<h4 id="orgdff78ba">Intermixing</h4>
<p>
Different privacy wallets are mostly complementary, but unfortunately it
seems that a zero sum approach is predominant in social media with regards
Bitcoin privacy wallet wallet userbases.
</p>

<p>
I hope this is only a selection effect, and instead of a binary approach,
encourage playing off of tools' relative strengths.
</p>

</section>
<section id="slide-orgdff78ba-split">
<p>
For example, JoinMarket has functionality well suited preparing smaller
amounts and change for (re-)mixing with Wasabi.
</p>

<p>
Again, assuming some adoption threshold, as these graphs intertwine the
benefits to both fungibility and privacy are compounding.
</p>
</section>
<section id="slide-org99d2100">
<h4 id="org99d2100">Lightning</h4>
</section>
<section id="slide-org99d2100-split">
<p>
Prepaid fees over LN
</p>
<ul>
<li>Fits well with LN privacy model</li>
<li>Does not necessitate complex integration</li>

</ul>

</section>
<section id="slide-org99d2100-split">
<p>
Deeper integration?
</p>
<ul>
<li><a href="https://joinmarket.me/blog/blog/coinjoinxt/">Adam Gibson's CoinJoinXT</a></li>
<li><a href="https://zmnscpxj.github.io/bitcoin/coinjoinxt.html">ZmnSCPxj's Chaumian followup</a></li>

</ul>

<p>
<object type="image/svg+xml" data="./images/coinjoinxt.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<object type="image/svg+xml" data="./images/chaumian_coinjoinxt.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>

<aside class="notes">
<p>
Integrating CoinJoin and channel funding/splicing requires <b>very</b> careful
consideration.
</p>

<p>
For example receiving change outputs from a coinjoin atomically over
lightning is a drastic departure from Wasabi's current privacy model.
</p>

<p>
Funding channels from coinjoins may be desirable in specific circumstances
(hiding origin of funding txns), but undesirable in others (linkage of
coinjoin related outputs to long lived identity).
</p>

<p>
What about other possible integrations?
</p>

<p>
Several of the talks in tomorrow's schedule sounds promising for thinking
about this intersection more clearly.
</p>

</aside>
</section>
<section id="slide-orgc6cf0a2">
<h4 id="orgc6cf0a2">Soft Forks</h4>
<p>
Segregated Witness was the great compositionality enabler, enabled
safe off-chain transaction graphs using multisignatures and time locks.
</p>

<p>
Schnorr signatures and Taproot extend this approach with better privacy and
fungibility, by reducing the on chain footprint.
</p>
<aside class="notes">
<p>
OP_STB talk earlier today.
</p>

</aside>

</section>
<section id="slide-org05c314d">
<h4 id="org05c314d">There-is-no-fork Meta Consensus Protocol Upgrades:</h4>
<p>
Newly practical MP-ECDSA brings some benefits of Schnorr signatures to
current consensus rules.
</p>

<p>
Particularly attractive for fungibility, given indistinguishability from
standard <code>P2{,W}PKH</code> outputs.
</p>
</section>
</section>
<section>
<section id="slide-orgfc46e29">
<h2 id="orgfc46e29">Summary</h2>
<p>
I have a lot of work left to do.
</p>
</section>
</section>
<section>
<section id="slide-org9be4846">
<h2 id="org9be4846">Thank You</h2>

<div class="figure">
<p><object type="image/svg+xml" data="./images/repo.svg" class="org-svg" style="vertical-align: middle; margin-top: -1em; position: absolute; right: -3em;">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
<a href="https://github.com/nothingmuch/zerolink-sudoku">https://github.com/nothingmuch/zerolink-sudoku</a>
</p>
</section>
</section>
</div>
</div>
<script src="reveal.js-3.8.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'reveal.js-3.8.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'reveal.js-3.8.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'reveal.js-3.8.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'reveal.js-3.8.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'reveal.js-3.8.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
